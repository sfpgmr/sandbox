<!DOCTYPE html>

<html lang="ja" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-15457703-9"></script>
  <script>
    if (!location.hostname.match(/localhost/)) {
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'UA-15457703-9');
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Twitter Viewer</title>
  <meta name="description" content="自作Twitter Viewerによる自分のつぶやきの記録。Programming,Music,HTML5,WebGL,javascript,WebAudio,Gameなど" />
  <meta name="keywords" content="Programming,Music,HTML5,WebGL,javascript,WebAudio" /> 	

  <meta itemprop="image" content="https://www.sfpgmr.net/img/sfweb.png" />
  <meta itemprop="name" content="S.F. Web" />
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="S.F. Web" />
  <meta name="twitter:url" content="./index24.html" />
  <meta name="twitter:title" content="Twitter Viewer" />
  <meta name="twitter:description" content="自作Twitter Viewerによる自分のつぶやきの記録。Programming,Music,HTML5,WebGL,javascript,WebAudio,Gameなど" />
  <meta name="twitter:image" content="https://www.sfpgmr.net/img/sfweb.png" />
  
  <meta property="og:type" content="article">
  <meta property="og:url" content="./index24.html" />
  <meta property="og:title" content="Twitter Viewer"/>
  <meta property="og:site_name" content="S.F. Web" />
  <meta property="og:description" content="Programming,Music,HTML5,WebGL,javascript,WebAudio">
  <meta property="og:image" content="https://www.sfpgmr.net/img/sfweb.png">

  <style>
  * {
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

html {
  margin: 0;
  padding: 0;
  font-size: 10px; }

body {
  margin: 0;
  padding-left: 8px;
  padding-right: 8px;
  background: black;
  color: white; }

.top-nav {
  position: fixed;
  z-index: 99999;
  background: rgba(0, 0, 0, 0.5);
  display: block;
  width: 100%;
  height: 32px;
  color: white; }

#sentinel {
  width: 0px;
  height: 0px; }

.contents {
  padding-top: 32px;
  width: 100%;
  position: relative;
  content: strict; }

@keyframes blinking {
  0% {
    color: black; }
  50% {
    color: white; }
  100% {
    color: black; } }

.loading {
  font-family: monospace;
  font-size: 24px;
  position: fixed;
  width: 100vw;
  height: 100vh;
  text-align: center;
  padding-top: 50vh;
  z-index: 32768;
  background: black;
  animation: blinking 2s infinite;
  content: strict; }

.contents > article {
  background: #f0f0f0;
  color: #202020;
  position: absolute;
  max-height: 960px;
  overflow: auto;
  border-radius: 3px;
  /* transition: opacity 1s linear;*/
  opacity: 1.0; }

.tweet-header {
  display: grid;
  align-items: end;
  grid-template-columns: 40px 2fr 1fr;
  grid-template-rows: 1fr;
  font-size: 12px;
  font-weight: bold; }

.tweet-img {
  width: 100%;
  object-fit: cover; }

.youtube {
  position: relative;
  cursor: pointer; }

.youtube > img {
  width: 100%;
  object-fit: cover; }

.youtube > svg.player-play {
  width: 64px;
  height: 64px;
  left: calc(50% - 32px);
  top: calc(50% - 32px);
  position: absolute;
  z-index: 1000;
  opacity: 0.5; }

.youtube:hover > svg.player-play {
  opacity: 1.0; }

.youtube:hover .player-play-1 {
  stroke: #80808080; }

.youtube > div.yt-title {
  /*text-shadow: #fff 1px 1px 0;*/
  font-size: 1.2rem;
  color: white;
  background: rgba(0, 0, 0, 0.5);
  position: absolute;
  left: 0;
  top: 0;
  overflow: auto;
  z-index: 998; }

.tweet-profile-img {
  grid-column: 1/2;
  width: 32px;
  height: 32px;
  border-radius: 50%; }

.tweet-user-name {
  grid-column: 2/3; }

.tweet-date {
  font-size: 8px;
  text-align: right;
  grid-column: 3/4; }

.contents > twitter-widget {
  overflow: auto;
  max-height: 960px;
  position: absolute; }

.contents > article > section > .tweet-text {
  display: block;
  padding: 4px;
  word-break: break-all;
  font-size: 12px; }

.contents > article > h3 {
  font-size: 12px; }

blockquote.card {
  margin: 4px;
  padding: 4px;
  font-size: 12px;
  background: white;
  border-radius: 4px; }

blockquote.card > header {
  display: grid;
  grid-gap: 4px;
  gap: 4px; }

blockquote.card-default > header {
  grid-template-columns: 64px 1fr; }

blockquote.card-large > header {
  grid-template-columns: 1fr; }

blockquote.card > header > img {
  width: 100%; }

div.no-image {
  display: block;
  width: 64px;
  height: 64px;
  background: gray;
  color: white;
  text-align: center;
  line-height: 64px; }
 
  </style>
</head>

<body>
  <div class="loading" id="loading">Loading</div>
  <header class="top-nav">
    <h1>S.F. Info.</h1>
  </header>
  <div class="contents" id="contents" rendersubtree="invisible skip-activation"> 
    
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1212701145379946496/pSDVrvWj_normal.png" />
        <p class="tweet-user-name">S.F.@SFPGMR</p>
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248792205096939520"
            target="_blank">2020/4/11 10:57:17</a></p>
      </header>
      <section>
        <p class="tweet-text">SMIというのはSMall Integer（小整数）の意味らしい。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248793206818365440"
            target="_blank">2020/4/11 11:01:16</a></p>
      </header>
      <section>
        <p class="tweet-text">小整数とは31ビットで表される整数値のこと。V8ではオブジェクトと小整数を32ビット整数値で管理しているらしい。そして32ビット目が0ならSMI、1ならオブジェクトとするようだ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248794976676237313"
            target="_blank">2020/4/11 11:08:18</a></p>
      </header>
      <section>
        <p class="tweet-text">普通の符号付き32ビット値より1ビット少ないのでSMIと呼んでるようだ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248795666656059393"
            target="_blank">2020/4/11 11:11:03</a></p>
      </header>
      <section>
        <p class="tweet-text">SMIはv8ではSmiというクラスで管理するようだ。そのコメントには以下が書いてあった。抜粋すると<br/><br/>Smi represents integer Numbers that can be stored in 31 bits.The ptr_ value has the following format: [31 bit signed int] 0</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248796511778926593"
            target="_blank">2020/4/11 11:14:24</a></p>
      </header>
      <section>
        <p class="tweet-text">さらに本来の32ビット整数値として扱うためのlong Smiというのもあるそうだ。<br/><br/>For long smis it has the following format:<br/>[32 bit signed int] [31 bits zero padding] 0</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248796822362968064"
            target="_blank">2020/4/11 11:15:38</a></p>
      </header>
      <section>
        <p class="tweet-text">V8内では処理やメモリ効率的にはSMIの範囲に値を納めることが望ましいんだな。おそらく統計的にその範囲で使われることが大半だったりするからこのようなフォーマットを採用してるのだろうか。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248797669713047552"
            target="_blank">2020/4/11 11:19:00</a></p>
      </header>
      <section>
        <p class="tweet-text">こりゃまあ、Smiクラスを見ないといかんなということで見てる。ここで出てきたconstexprキーワード。これなんだったっけ？（笑）。なんか関数をコンパイル時に評価・実行するんだったっけかな。。しかしなぜコンストラクタに。。 https://t.co/VjR10Szgw2</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVSej8TU4AAToCe.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248799111890915328"
            target="_blank">2020/4/11 11:24:44</a></p>
      </header>
      <section>
        <p class="tweet-text">constexprの説明。クラスがコンパイル時に評価・実行可能な場合につけることが可能なのか。このSmiクラスは静的評価可能なんだな。なんとなくこのSmiは頻繁に利用されそうなのでコンパイル時に評価できるのであればそのほうがパフォーマンス的にありがたいよなあ。。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://cpprefjp.github.io/lang/cpp11/constexpr.html" target="_blank">constexpr - cpprefjp C++日本語リファレンス</a></header><div>`constexpr`は、汎用的に定数式を表現するための機能である。</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248799347891785729"
            target="_blank">2020/4/11 11:25:40</a></p>
      </header>
      <section>
        <p class="tweet-text">それは左辺によるんだろうけど。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248799642604597248"
            target="_blank">2020/4/11 11:26:51</a></p>
      </header>
      <section>
        <p class="tweet-text">いろいろ疑問はあって調べたいことがあるが昼食の準備をしないといかんので午前中はここまでとしよう。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248866490318598144"
            target="_blank">2020/4/11 15:52:28</a></p>
      </header>
      <section>
        <p class="tweet-text">まあここで重要なのはSMIであれば整数なのは確実だっていうことですな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248897610686971905"
            target="_blank">2020/4/11 17:56:08</a></p>
      </header>
      <section>
        <p class="tweet-text">ちょっと別スレッドでIsInt32Double()を調べていたが、結局のところ、割と愚直な方法で整数かどうかチェックしているということですわな。。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://twitter.com/SFPGMR/status/1248896544729788416" target="_blank"></a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248898852943360000"
            target="_blank">2020/4/11 18:01:04</a></p>
      </header>
      <section>
        <p class="tweet-text">まあnode-addon-apiではValue::IsInt32()メソッドはないが、それに相当するようなメソッドで自分で書けないことはない。が、残念ながらとりえる値が整数であるかどうかわかったとしても、もともとの型が整数型かどうかがわからんわけですわな。いやちがうな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248900750199013377"
            target="_blank">2020/4/11 18:08:36</a></p>
      </header>
      <section>
        <p class="tweet-text">そもそもJSの規格上は数値というのはdoubleのみなわけで、整数型はないんだよな。そもそもとりえる値が整数の範囲内にあるっていうだけで。だったかな？規格書読まんといかんな、これまた。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248901475759050758"
            target="_blank">2020/4/11 18:11:29</a></p>
      </header>
      <section>
        <p class="tweet-text">SMIとかいうのもV8の世界の話で、処理効率化やリソース消費を抑えるための便宜的なものだと思う。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248902339374665728"
            target="_blank">2020/4/11 18:14:55</a></p>
      </header>
      <section>
        <p class="tweet-text">そもそもsqlite3は整数型を持っているので、プリペアードステートメントに値をbindするとき、整数型のフィールドであればそこには整数をセットしないといけない。あたりまえだけど。だからbindの文脈におけるJSの数値はsqlite3のフィールドの型に左右される。これも当たり前だ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248902946500182016"
            target="_blank">2020/4/11 18:17:20</a></p>
      </header>
      <section>
        <p class="tweet-text">つまりJSから与えられる値は常にdoubleであって、それをsqlite3のフィールドにセットするとき、sqlite3のフィールドの型が何であるかによって、変換しなければならないよな。その際フィールドが整数型であった場合、JSの値が整数の範囲に収まっているか確認すればいいんだよな。それ以外はエラーだよ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248904148319211520"
            target="_blank">2020/4/11 18:22:07</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしこの当たり前な話、なかなか難しいんだよな。プリペアード・ステートメントを<br/><br/>select a,b from tbl where a = ? and b= ?<br/><br/>としたとき、?に入る値の型は何かを事前に知っておかなくてはならないということになる。これを事前に知る方法ってあるのかいな？</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248905973697138689"
            target="_blank">2020/4/11 18:29:22</a></p>
      </header>
      <section>
        <p class="tweet-text">当初JSからは緩いbindを考えていて先ほどのステートメント<br/>select a,b from tbl where a = ? and b= ?<br/><br/>だとJSでは<br/><br/>stmt.bind(['text',1]);<br/><br/>と書くようなメソッドに仕立てようと思っていた。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248906238835871744"
            target="_blank">2020/4/11 18:30:25</a></p>
      </header>
      <section>
        <p class="tweet-text">配列の1番目から順にパラメータにバインドしていくわけですな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248906637567385601"
            target="_blank">2020/4/11 18:32:00</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしまあパラメータの型によってsqlite3_bind_xxを呼び分けないといけないわけで、最初は指定するJSの型判定を行って、それでsqlite3_bind_xxを呼び分けようとしていたわけ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248907357779660800"
            target="_blank">2020/4/11 18:34:52</a></p>
      </header>
      <section>
        <p class="tweet-text">が、JSの数値に関してはそれが整数であるかどうかは判別できるにしても、doubleだがたまたま整数の範囲に入ってしまうこともあるわけで、その場合はsqlite3_bind_xxの呼び出しが失敗してしまうんだよね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248908254513512448"
            target="_blank">2020/4/11 18:38:26</a></p>
      </header>
      <section>
        <p class="tweet-text">じゃあ参考にしているnode_sqlite3はどうしてるのかというと、NanでできていてV8に依存してるので、内部的なメソッドを使ってそれが整数かどうか判定している。がしかし、厳密にいうと同じ問題を抱えている。多少正確性が増す程度かなと思ったりする。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248908583946694656"
            target="_blank">2020/4/11 18:39:44</a></p>
      </header>
      <section>
        <p class="tweet-text">さっき見てきたようにV8も整数の判定が、SMIかどうか・整数の範囲に収まっているかどうかで見ているのでね。SMIかどうかというのが正確性が増すのでは？という理屈なんだけど。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248908930429775872"
            target="_blank">2020/4/11 18:41:07</a></p>
      </header>
      <section>
        <p class="tweet-text">なので根本的には、プリペアードステートメントのパラメータのデータ型を正確に判定して、それに応じてJSの値を適切に変換するのがよい、とこう考えるわけですな。今のところ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248910105745080320"
            target="_blank">2020/4/11 18:45:47</a></p>
      </header>
      <section>
        <p class="tweet-text">でそのバインドするパラメータのデータ型を知ることができるのかというと、APIを見る限りなさそうなんですな。これが。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://www.sqlite.org/c3ref/stmt.html" target="_blank">Prepared Statement Object</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248910394510336001"
            target="_blank">2020/4/11 18:46:56</a></p>
      </header>
      <section>
        <p class="tweet-text">バインドパラメータに関するAPIは以下の３つ<br/><br/>sqlite3_bind_parameter_count<br/>sqlite3_bind_parameter_index<br/>sqlite3_bind_parameter_name</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248910551666708482"
            target="_blank">2020/4/11 18:47:33</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3_bind_parameter_type というのが欲しいところだが、ないんだな、これが。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248912556544024577"
            target="_blank">2020/4/11 18:55:31</a></p>
      </header>
      <section>
        <p class="tweet-text">こうなると型判定をしてライブラリ側でよしなにバインドするというのはちょっと無理筋で、JS側にもsqlite3_bind_xxのラッパーをexportしてJS側で呼び分けてもらうしかないよな。利用者側はテーブルのフィールド型がなんであるかは事前にわかってるからね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248912937932034050"
            target="_blank">2020/4/11 18:57:02</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしsqlite3のstatementに関するAPIはsqlite3_stmt構造体のポインタを指定するので、この構造体中に情報が保持されているはずなんだけどな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248913158728642560"
            target="_blank">2020/4/11 18:57:55</a></p>
      </header>
      <section>
        <p class="tweet-text">このsqlite3_stmt構造体覗いたら所望のことができんかな。。でも構造体を直接触るのはちょっとなあ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248914075695714306"
            target="_blank">2020/4/11 19:01:34</a></p>
      </header>
      <section>
        <p class="tweet-text">ああ、さっきの整数化のところで-0をなんで整数ではないと判定しているかというと、JSの規格上Int32に変換すると-0は+0に変換されるからなんだよな。規格書のNoteに書いてあった。つまり整数ならば-0はJSの規格上ありえないということ。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://www.ecma-international.org/ecma-262/10.0/index.html#sec-toint32" target="_blank">ECMAScript® 2019 Language Specification</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248914307087077378"
            target="_blank">2020/4/11 19:02:29</a></p>
      </header>
      <section>
        <p class="tweet-text">もちろんNumberの世界では-0はあり得る。あくまでInt32整数上での話。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248914983179530240"
            target="_blank">2020/4/11 19:05:10</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3にオレオレAPIを追加するというのもありだが、そうなるとsqlite3の内部構造も知らないといけなくなって、際限なくなる感じ。。ブログのデータ・ストア先として使おうと思ってただけなのに、なんでこんなことしてるのか。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248945800077402112"
            target="_blank">2020/4/11 21:07:37</a></p>
      </header>
      <section>
        <p class="tweet-text">趣味だからいいんだけど。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1248958406578196485"
            target="_blank">2020/4/11 21:57:43</a></p>
      </header>
      <section>
        <p class="tweet-text">少しsqlite3_prepareあたりのコードを読み始めてる。オープン・ソースなんでその気になればいくらでも読むことができるんだよな。理解できる・できないは別にして（笑）。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249240796148031490"
            target="_blank">2020/4/12 16:39:50</a></p>
      </header>
      <section>
        <p class="tweet-text">ちょっと今日はだらだらしてしまった。。sqlite3のprepareあたりのコードを追ってみた。追っていくとVdbe構造体にバインドパラメータ（変数）の情報が入っていた。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249241612779053061"
            target="_blank">2020/4/12 16:43:04</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3_prepareされるとsql statementがパースされてsqlite3_stmt構造体へのポインタが返されるわけだが、実体はVdbe構造体である。Vdbe構造体はVirtual Database Engineのインスタンスである。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249242444454957057"
            target="_blank">2020/4/12 16:46:23</a></p>
      </header>
      <section>
        <p class="tweet-text">VDBEはSQL Statementが解析された後にできるMicro Opコード列を実行する仮想マシンのようなものらしい。その管理を行うのがVdbe構造体である。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249243514916835328"
            target="_blank">2020/4/12 16:50:38</a></p>
      </header>
      <section>
        <p class="tweet-text">以下のようなsqlをprepareした場合Vdbe構造体のnVarに2が入りそしてaVar[]に変数分のMem構造体がセットされる。<br/><br/>select * from test where a=? and b=?<br/><br/>Mem構造体というのはsqlite3_valueのtypedefである。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249243968644120582"
            target="_blank">2020/4/12 16:52:26</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3_valueというのは名前通り値の型や値そのもの、状態などを格納する構造体である。 https://t.co/GTc08hbC5w</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVY0gCIUMAAVlGm.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249245215405133825"
            target="_blank">2020/4/12 16:57:23</a></p>
      </header>
      <section>
        <p class="tweet-text">で私の推測としてはprepareしたときに変数（placeholder)がaVarに格納され、その際Mem構造体のflagsにその変数の型情報が入るのかと思った。が実際は違っていて、変数型としてNullがセットされていた。よってここを見ても事前に型情報を取得することはできない。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249245882077208582"
            target="_blank">2020/4/12 17:00:02</a></p>
      </header>
      <section>
        <p class="tweet-text">ようするに変数分のMemのエリアは確保されるものの、そこには必要な変数の型情報はprepare時ではわからないということだ。そしてsqlite3_bind_xxのコードを追ってみたところ、そこではprepareで確保したMem構造体に単にxx型に値をセットするだけで型チェックは行っていなかった。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249246609252081665"
            target="_blank">2020/4/12 17:02:56</a></p>
      </header>
      <section>
        <p class="tweet-text">そうするとsqlite3_step()で変数とカラムの型情報の比較をするのかなあ？と今思ってるところ。ソースを熟読していないので誤りがあるかもしれないが、今はそんな感じの理解。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249471517018083328"
            target="_blank">2020/4/13 7:56:38</a></p>
      </header>
      <section>
        <p class="tweet-text">プリペアードステートメントのparseとVMオペレーションへの変換→変数のバインド→VMオペコード実行の詳細がいまいち理解できないでいる。今はparserのソースコードparse.yを読んでいるところ。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://www.sqlite.org/src/artifact?ci=trunk&filename=src/parse.y" target="_blank">SQLite: Artifact [5bdb760a]</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249472791167942656"
            target="_blank">2020/4/13 8:01:42</a></p>
      </header>
      <section>
        <p class="tweet-text">これはlemonというパーサー・ジェネレータのソースコード。シンタックスの構文とアクション（Cで書ける）が1本のソースファイルにまとめて書けるタイプ。wikipediaによればsqliteのためにメンテナンスが続けられているらしい。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://en.wikipedia.org/wiki/Lemon_(parser_generator)" target="_blank">Lemon (parser generator) - Wikipedia</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249473436402872321"
            target="_blank">2020/4/13 8:04:15</a></p>
      </header>
      <section>
        <p class="tweet-text">専用パーサー・ジェネレータみたいになっている（笑）。他で使っているのあまり聞いたことないよな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249474578759290880"
            target="_blank">2020/4/13 8:08:48</a></p>
      </header>
      <section>
        <p class="tweet-text">syntaxがいまいちよくわからんのでここを読もうとしている。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://sqlite.org/src/doc/trunk/doc/lemon.html" target="_blank">The Lemon Parser Generator</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249475043047817217"
            target="_blank">2020/4/13 8:10:39</a></p>
      </header>
      <section>
        <p class="tweet-text">これ今のバージョンの参考になるのかわからんけど「Inside SQLite」なる書籍がFreeで公開されている。CHMファイルという今では珍しいファイル形式での提供。。<br/><br/><blockquote class="card card-default"><header><img  src="https://epdf.pub/assets/img/epdf_logo.png" /><a href="https://epdf.pub/inside-sqlite.html" target="_blank">Inside SQLite - PDF Free Download</a></header><div>...</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249477046444552195"
            target="_blank">2020/4/13 8:18:36</a></p>
      </header>
      <section>
        <p class="tweet-text">なんかlemonのsecurity noteがちょっと面白い。。<br/><br/>・Parser code generated by lemon → Robust and secure<br/>・The "lemon.exe" command line tool itself → Not so much<br/><br/>・lemonパーサーが作るパーサーコードは堅牢かつ安全<br/>・lemon.exe自身はそうでもない。<br/><br/>なんか正直。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249480346183143424"
            target="_blank">2020/4/13 8:31:43</a></p>
      </header>
      <section>
        <p class="tweet-text">ああ、lemonいうところの<br/><br/>・Terminal Symbol（Token） : 英大文字ではじまる英数字およびアンダースコアで構成される文字列<br/>・Non Terminal Symbol （Token）: 英小文字ではじまる英数字およびアンダースコアで構成される文字列</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249835591048413184"
            target="_blank">2020/4/14 8:03:20</a></p>
      </header>
      <section>
        <p class="tweet-text">lemonパーサーのことを調べて、prepared statementにおける「a = ?」の型チェックはどこで行っているのかを調べようとしていた。<br/><br/>select a,b from tbl where a = ? <br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://twitter.com/SFPGMR/status/1249801561976352768" target="_blank"></a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249836205161644032"
            target="_blank">2020/4/14 8:05:46</a></p>
      </header>
      <section>
        <p class="tweet-text">prepared statementはどのようにパースされているのか調べるためにlemon調べてたんだけど、sqlite3_prepareの結果が変数に型なし（NULL）が設定されている時点でパーサーではそこまで見ていないということは自明だったが、なぜかパーサーのコードを読んでしまっていた（笑）。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249838687644299264"
            target="_blank">2020/4/14 8:15:38</a></p>
      </header>
      <section>
        <p class="tweet-text">もう少し具体的にいうと<br/>where a = ?はprepareすると<br/><br/>where <br/>|<br/>=<br/>| \<br/>a ?<br/>のようなツリーになるわけですな。でこの時点でaはTK_ID、?はTK_VARIABLEで識別されている。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249839650174144512"
            target="_blank">2020/4/14 8:19:28</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしこの時点で「a」と「?」の型情報は持っていない。またsqlite3_bind_xxで?の部分にxxのデータ型で値をセットしているが、その際aとの型が一致しているかどうかのチェックは行っていないようだった。そうするとsqlite3_stepの段階、つまり実行時の段階で型チェックを行っているのだろうか。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249845331300192256"
            target="_blank">2020/4/14 8:42:02</a></p>
      </header>
      <section>
        <p class="tweet-text">ああ、そうだった。sqlite3_prepareではさらにVDBEへの命令生成も行ってるようだね。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249846319335653379"
            target="_blank">2020/4/14 8:45:58</a></p>
      </header>
      <section>
        <p class="tweet-text">いや違うか。。どっちやねん。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249848675171364865"
            target="_blank">2020/4/14 8:55:19</a></p>
      </header>
      <section>
        <p class="tweet-text">このへんはさらに調査が必要。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1249982967318859776"
            target="_blank">2020/4/14 17:48:57</a></p>
      </header>
      <section>
        <p class="tweet-text">ここのところはVDBEの仕様の理解が必要ですなあ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250147076677066752"
            target="_blank">2020/4/15 4:41:04</a></p>
      </header>
      <section>
        <p class="tweet-text">今日はVDBEの勉強ですなあ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250183766921764864"
            target="_blank">2020/4/15 7:06:51</a></p>
      </header>
      <section>
        <p class="tweet-text">Sqliteは2.Xから3.Xへの移行時に、VMがスタック・マシンからレジスタ・マシンに移行したのかあ。。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://www.sqlite.org/vdbe.html" target="_blank">The Virtual Database Engine of SQLite</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250184751429767168"
            target="_blank">2020/4/15 7:10:46</a></p>
      </header>
      <section>
        <p class="tweet-text">これが今のOpコードなんだな。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://www.sqlite.org/opcode.html" target="_blank">The SQLite Bytecode Engine</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250186629026742273"
            target="_blank">2020/4/15 7:18:14</a></p>
      </header>
      <section>
        <p class="tweet-text">コード見てるとB-Treeとかそういうレガシーなキーワードが出てきて興味ぶかい。ISAM・KSAMを使ったデータベース上でCOBOLベースの販財給システムのコードを少し書いてたころNetWareが出てきた。そしてそこで動く販財給システムではデータ・ストアにB-Treeを使っていて高速だという謳い文句だったな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250187847111327744"
            target="_blank">2020/4/15 7:23:04</a></p>
      </header>
      <section>
        <p class="tweet-text">KSAMというのはHPのスタックマシン上で動いてたMPE(Multi Programming Executive)というOS上で使えたISAM形式のデータファイルおよびそのメソッドだったと思う。マニュアルもあったな。。<br/><a href="http://www.teamnaconsulting.com/compresources/pdfs/32650-90386.pdf" target="_blank">teamnaconsulting.com/compresources/…</a></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250188772580327425"
            target="_blank">2020/4/15 7:26:45</a></p>
      </header>
      <section>
        <p class="tweet-text">初期のHP-3000は物理CPUがスタック・マシンだったんだよな。私はCOBOL IIX上からしか使ってないから当時よくわからんかったけどね。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250189485607813121"
            target="_blank">2020/4/15 7:29:35</a></p>
      </header>
      <section>
        <p class="tweet-text">ソースをコンパイルした後prepとかいうコマンドで実行できる形式になったんだよな。確か。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250190175180734464"
            target="_blank">2020/4/15 7:32:19</a></p>
      </header>
      <section>
        <p class="tweet-text">B-Treeはレガシーだけど今でもがっつり使われているけどね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250191379197644800"
            target="_blank">2020/4/15 7:37:06</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3_prepareはSQL文をVDBEバイトコードへコンパイルするAPI。sqlite3_stepはバイトコードを実行するAPI。sqlite3_bindはバイトコード上の変数に値をバインドするAPIかあ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250194285296640000"
            target="_blank">2020/4/15 7:48:39</a></p>
      </header>
      <section>
        <p class="tweet-text">EXPLAINで出てくる実行プランの１行１行がバイトコードなんですな。 https://t.co/IfQgtLp1ev</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVmU_UWUMAEgear.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250196836381384704"
            target="_blank">2020/4/15 7:58:47</a></p>
      </header>
      <section>
        <p class="tweet-text">オペコードは５つのパラメータ（オペランド）で構成される。カーソル操作命令はP1がカーソル番号になるとのこと。そしてジャンプ命令はP2がジャンプ先・アドレスになるとのこと。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250197499630911488"
            target="_blank">2020/4/15 8:01:26</a></p>
      </header>
      <section>
        <p class="tweet-text">よって最初のInitでP2が10だからまず10行目に行くわけですな。サブルーチンかあ。そしてそしてレジスタ２に'aaaa'を代入しそして1行目にgotoかあ。 https://t.co/vv2gmmuUqg</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVmXgvDVAAAmHy9.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250198129124585472"
            target="_blank">2020/4/15 8:03:56</a></p>
      </header>
      <section>
        <p class="tweet-text">P4はふつう値が入り、そしてP5はフラグなどが入るとのこと。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250201323544309760"
            target="_blank">2020/4/15 8:16:37</a></p>
      </header>
      <section>
        <p class="tweet-text">vdbe.cを読むとオペコードの詳細な説明がある。 https://t.co/yF28u8vn1s</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVmbeQMVAAEbdlN.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250229589260959746"
            target="_blank">2020/4/15 10:08:56</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3_step()ではResultRowもしくはHaltまで実行されてそこで制御が戻る。ResultRowで取得した行データはsqlite3_column_xxで列データを取得する。そして次のsqlite3_step()で実行を再開する。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250229764763213824"
            target="_blank">2020/4/15 10:09:38</a></p>
      </header>
      <section>
        <p class="tweet-text">レジスタに列の値が入ってくるんですな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250231273722753025"
            target="_blank">2020/4/15 10:15:38</a></p>
      </header>
      <section>
        <p class="tweet-text">Openxxxというのはカーソルをオープンするということか。OpenRead/OpenWriteの2種類あるのですな。Next/Prevでカーソルを移動すると。Rewindとかもあるね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250232640101158913"
            target="_blank">2020/4/15 10:21:04</a></p>
      </header>
      <section>
        <p class="tweet-text">このドキュメントを今読んでるところですわ。。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://www.sqlite.org/opcode.html" target="_blank">The SQLite Bytecode Engine</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250233073561550848"
            target="_blank">2020/4/15 10:22:47</a></p>
      </header>
      <section>
        <p class="tweet-text">coroutine関係のOpコードもあるな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250241285887152129"
            target="_blank">2020/4/15 10:55:25</a></p>
      </header>
      <section>
        <p class="tweet-text">等価や比較演算子に関しては型を変換して比較を試みるようですな。要するに値の等価・比較の際は型が異なると偽にはならず、型を合わせるために変換した結果で真偽判断が行われるようである。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250241633087401984"
            target="_blank">2020/4/15 10:56:48</a></p>
      </header>
      <section>
        <p class="tweet-text">まあこういうことですわな。<br/>a=1の時はおそらく1が文字列に変換されて比較されると。 https://t.co/jDgJMUJpk7</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVm_2_DU4AA4i_Z.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250241823127113728"
            target="_blank">2020/4/15 10:57:33</a></p>
      </header>
      <section>
        <p class="tweet-text">おそらくというかソースコードがそうなってるから間違いないわな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250244087678005249"
            target="_blank">2020/4/15 11:06:33</a></p>
      </header>
      <section>
        <p class="tweet-text">intのaフィールドに対して、いろいろな型でwhere句を書いてみた。なかなかおもしろい結果ですわな。エラーにはならず、何らかの変換が施され比較された結果で行がフィルタされてるというわけですわな。 https://t.co/IEYlogDeYC</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVnCBMGU4AAqWua.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250244994964672512"
            target="_blank">2020/4/15 11:10:09</a></p>
      </header>
      <section>
        <p class="tweet-text">int型のaフィールドに対して where a = 1.01とした時の結果は、1.01が整数化され、その値とaフィールドの値「1」が一致して表示されると思ったけど、結果はそうじゃなかった。この結果からみるとReal型で比較した結果のように思える。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250248788314210304"
            target="_blank">2020/4/15 11:25:14</a></p>
      </header>
      <section>
        <p class="tweet-text">この比較や等価演算子の際の変換はP5にセットされる値がSQLITE_AFF_NUMERICの場合は比較の両辺を数値に、そしてSQLITE_AFF_TEXTのときは両辺を文字列に変換して比較するんだよね。そのあとは単純に値をmemcmpで比較してるんだよなあ。このSQLITE_AFF_XXXはprepare時にセットされるんだろうな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250319066197184522"
            target="_blank">2020/4/15 16:04:29</a></p>
      </header>
      <section>
        <p class="tweet-text">いや、sqlite3MemCompareは単純にmemcmpで比較しているのではなかった。このあたり結構複雑なコードである。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250320292745891840"
            target="_blank">2020/4/15 16:09:22</a></p>
      </header>
      <section>
        <p class="tweet-text">結論としては、Sqlite3では式をprepareするときには型チェックは行わない。実行時には型チェックを行うが、それは式のアンマッチを真偽判定に使うわけではなく、式中の型を揃えるために行う。行った結果が有効な式であればそれは実行されるようだ。つまりエラーにはならない。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250321470460317696"
            target="_blank">2020/4/15 16:14:03</a></p>
      </header>
      <section>
        <p class="tweet-text">こういうこと。<br/><br/>select * from tbl3 where a = "000000" + 1;<br/><br/>int型のaフィールドに対して以上のような式を書いても有効である。a = 1の行が返ってくる。 https://t.co/gB7Z1zmK4s</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVoIXnHU8AcGnMn.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250321761419161601"
            target="_blank">2020/4/15 16:15:12</a></p>
      </header>
      <section>
        <p class="tweet-text">こういうのも有効だということですわな。。<br/> <br/>select * from tbl3 where a = "2" - "1"; https://t.co/fmwXoUQYh5</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EVoI7tmUYAEp_Tb.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250324923991515144"
            target="_blank">2020/4/15 16:27:46</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3の式がこのような感じで動くとすると、そもそもnodeからsqlite3に渡す値がdoubleかintかによってsqlite3_bind_xxを正確に呼び分けるなんていうのはどうでもいいことだよな。どっちを渡しても式の実行時にsqlite3がよしなに変換してくれるんだからね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250326125751848960"
            target="_blank">2020/4/15 16:32:32</a></p>
      </header>
      <section>
        <p class="tweet-text">node-addon-apiは値が数字が文字列かオブジェクトかくらいはわかるから、bindするときに値が数値だったらreal、文字列はtext、オブジェクトはJSON.stringify()してtextで渡すくらいでいいな。とすると当初考えていた緩いAPIでbindするようにしようか。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250327110473793536"
            target="_blank">2020/4/15 16:36:27</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3自体面白いライブラリだ。ステートメントをコンパイルしてVMで実行するあたりとか。ソースコードも比較的読みやすい。そしてコメントがきっちりと書いてあるのがすごいと思った。ただ変数のハンガリアン風記法がちょっと好みじゃないけど。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250330604115124225"
            target="_blank">2020/4/15 16:50:20</a></p>
      </header>
      <section>
        <p class="tweet-text">しかし<br/><br/>select * from tbl where a = ?;<br/><br/>というステートメントを実行するとき、aがintであったときは?にはsqlite3_bind_intでbindしたほうが（型を合わせてbindしたほうが）実行時のパフォーマンスは良くなる。そのために型指定のバインドもAPIとして用意しておこうと思う。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250334341030244352"
            target="_blank">2020/4/15 17:05:11</a></p>
      </header>
      <section>
        <p class="tweet-text">ということでnode-addon-apiによるsqlite3のnodeバインディングの作成を続けることにしよう。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1250957040505155584"
            target="_blank">2020/4/17 10:19:34</a></p>
      </header>
      <section>
        <p class="tweet-text">ちゅうことでsqlite3_bindのラッパーを書いているところ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251052850207064064"
            target="_blank">2020/4/17 16:40:17</a></p>
      </header>
      <section>
        <p class="tweet-text">書いている途中でいろいろおもうことがあってまたここを読んでいる。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://nodejs.org/dist/latest/docs/api/addons.html" target="_blank">C++ addons | Node.js v14.8.0 Documentation</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251426231750279168"
            target="_blank">2020/4/18 17:23:58</a></p>
      </header>
      <section>
        <p class="tweet-text">とりあえずstatementをprepareしてstepしてfinalizeするとこまで動くaddonのコードを書いた。まあまあsqliteのAPIどおりに実装している。 https://t.co/WlioqKOQ5F</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EV31GbNUMAIhMpP.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251426346896519169"
            target="_blank">2020/4/18 17:24:26</a></p>
      </header>
      <section>
        <p class="tweet-text">あ、「bindして」が抜けていた。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251426851198652418"
            target="_blank">2020/4/18 17:26:26</a></p>
      </header>
      <section>
        <p class="tweet-text">bindも型指定のAPIが使えるようになっている。<br/>このあたりはもう判でついたような実装なのでとてもつまらない。。 https://t.co/rHCVdhNRCR</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EV31-FFU8AAuPaa.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251427362010357760"
            target="_blank">2020/4/18 17:28:28</a></p>
      </header>
      <section>
        <p class="tweet-text">bindBrobはTypedArray限定仕様にしてる。今のところ。Bufferもサポートしないといかんのかもしれん。とりあえず同期版を実装してみてstep()以外非同期にする必要があるのかなあと今思っているところ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251428271046012929"
            target="_blank">2020/4/18 17:32:04</a></p>
      </header>
      <section>
        <p class="tweet-text">sqliteのAPIもそこそこ数あるが、JS側で使える機能はできる限りexportしておきたい。あとnode-sqlite3のAPIで持ってたeachとかgetとかはサポートしておきたいね。 https://t.co/rYjzzFEyng</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EV327twU4AAAGA9.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251439950123286528"
            target="_blank">2020/4/18 18:18:29</a></p>
      </header>
      <section>
        <p class="tweet-text">step()はファイルI/Oも入るから非同期にする価値あるよなあ。。と今なってる。大きいテーブルをupdateするときも長期間ブロックしそうだしね。うん。ようやく非同期版を実装するモチベーションが出てきた。よってstatement全般を非同期化しよう。もちろん同期版も用意するけど。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251474296280461312"
            target="_blank">2020/4/18 20:34:58</a></p>
      </header>
      <section>
        <p class="tweet-text">Blobにオブジェクトをそのままストア出来るようにしたらちょっといいかなあと思った。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251845996721520640"
            target="_blank">2020/4/19 21:11:58</a></p>
      </header>
      <section>
        <p class="tweet-text">std::anyってc++17から使えるのか。昔から使ってた気がするが、あれはboost::anyかあ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251846462163390470"
            target="_blank">2020/4/19 21:13:49</a></p>
      </header>
      <section>
        <p class="tweet-text">statementのメソッドの非同期サポートをぼちぼち進めている。。 https://t.co/o3TWXJzons</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EV9zs8NUMAA-xag.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251846954822201349"
            target="_blank">2020/4/19 21:15:46</a></p>
      </header>
      <section>
        <p class="tweet-text">boost::formatなんかもすごく便利に使ってたんだけど、それの標準ライブラリ版のstd::formatはC++20でのサポートかあ。。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://cpprefjp.github.io/reference/format/format.html" target="_blank">format - cpprefjp C++日本語リファレンス</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251847222473289729"
            target="_blank">2020/4/19 21:16:50</a></p>
      </header>
      <section>
        <p class="tweet-text">あとテンプレート周りとかメタ・プログラミングあたりの知識もアップデートせんといかんよなあ。。かなりコンパイル時にやれることが増えてそうだし。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251849636840484864"
            target="_blank">2020/4/19 21:26:26</a></p>
      </header>
      <section>
        <p class="tweet-text">MPLとかLokiとかのメタ・プログラミングで使われたテクニックとかはもう言語仕様のサポート等で不要になってるものもありそうだしなあ。。トリッキーで面白いライブラリでしたな。あんまり理解できんかったけど。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251851278528835587"
            target="_blank">2020/4/19 21:32:57</a></p>
      </header>
      <section>
        <p class="tweet-text">JSをいじってるせいか、以前に比べてlamdaとか関数オブジェクトとか引数束縛とか使うのに抵抗感がなくなってるわ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251853159040876544"
            target="_blank">2020/4/19 21:40:26</a></p>
      </header>
      <section>
        <p class="tweet-text">こんな感じのコードがJSで書けるようになった。 https://t.co/eAUYBWfwvc</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EV95zRjUYAAFucF.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251986823833743360"
            target="_blank">2020/4/20 6:31:34</a></p>
      </header>
      <section>
        <p class="tweet-text">まず一通り非同期処理できるようになった。 https://t.co/cC2viOJNqN</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EV_zX_pU0AEfS-S.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251987792181071872"
            target="_blank">2020/4/20 6:35:25</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3に関する処理はnode-addon-apiのAPIAsyncWorkerによってワーカー・スレッドで非同期に行われる。ちょっとリソースのライフタイム管理に不安な面あり。どこがスタックでどこがフリーストアでだとか、きちんとリソースの所有権が意図したように移譲されてるのかな？とかね。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251988479900176386"
            target="_blank">2020/4/20 6:38:09</a></p>
      </header>
      <section>
        <p class="tweet-text">v8上のリソースはgcで管理されているようだ。HandleScopeなんちゅうメソッドがあって、スコープ中でのリソース回収をブロックすることができたりとか、まあそういう感じ。リソースの管理が少し難しいというか、はっきり理解してないところも少々不安。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251989925395697665"
            target="_blank">2020/4/20 6:43:53</a></p>
      </header>
      <section>
        <p class="tweet-text">C++もmoveセマンティクスとか、スマポとかアロケータとか、メモリ管理あたりの理解も乏しい。。このあたりゲーム作ろうとしてかなり勉強＆研究してたつもりなんだけど、ほとんど忘れてるわ（笑）。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251993496547815424"
            target="_blank">2020/4/20 6:58:05</a></p>
      </header>
      <section>
        <p class="tweet-text">Napi::AsyncWorker &amp; Napi::Promiseによる非同期処理は比較的簡単に書ける。もともとのnode-sqlite3はnanとlibuvで実装されていて、uv_queue_workを使って非同期処理を実現していた。uv_queue_workによる実装は手続きが面倒で利用者が書くコードもかなり長くなりがち。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251994020798058496"
            target="_blank">2020/4/20 7:00:10</a></p>
      </header>
      <section>
        <p class="tweet-text">nanもAsyncWokerがあるんだけど、node-sqlite3が作られたころはこれがなかったんだろうなあと思う。<br/><br/><blockquote class="card card-default"><header><img  src="https://avatars1.githubusercontent.com/u/9950313?s=400&v=4" /><a href="https://github.com/nodejs/nan/blob/master/doc/asyncworker.md" target="_blank">nan/asyncworker.md at master · nodejs/nan · GitHub</a></header><div>Native Abstractions for Node.js. Contribute to nodejs/nan development by creating an account on GitHub.</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1251994789571989504"
            target="_blank">2020/4/20 7:03:13</a></p>
      </header>
      <section>
        <p class="tweet-text">アドオンを書く側はnan+libuvだと冗長になりがち。でも結局APIでv8やlibuvに対する処理が隠蔽されるだけで、実行にかけるコストは同じかむしろnode-addon-apiのほうが高いんじゃないかと思う。実装の容易さは実行時のコストで支払うのが世の常ですからな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252006621556834304"
            target="_blank">2020/4/20 7:50:14</a></p>
      </header>
      <section>
        <p class="tweet-text">StatementやDatabaseはまだ実装しなければならないAPIはいろいろあるんだけど、Backupを先に作ることにする。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252028499570724867"
            target="_blank">2020/4/20 9:17:10</a></p>
      </header>
      <section>
        <p class="tweet-text">うーむ。右辺値参照&amp;&amp;なんてのもあるなあ。忘れてた。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252032326688628739"
            target="_blank">2020/4/20 9:32:22</a></p>
      </header>
      <section>
        <p class="tweet-text">ひぃい。右辺値参照とムーブセマンティクスあたりはやっぱりわかりにくいや。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252032399124250624"
            target="_blank">2020/4/20 9:32:40</a></p>
      </header>
      <section>
        <p class="tweet-text">これ読んだ。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://cpprefjp.github.io/lang/cpp11/rvalue_ref_and_move_semantics.html" target="_blank">右辺値参照・ムーブセマンティクス - cpprefjp C++日本語リファレンス</a></header><div>ムーブセマンティクスはコピーコストの削減を主な目的としており、また所有権の移動を実現する。  </div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252040194292776960"
            target="_blank">2020/4/20 10:03:38</a></p>
      </header>
      <section>
        <p class="tweet-text">テンプレートのエイリアスも使えるようになってるんだ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252089598664007680"
            target="_blank">2020/4/20 13:19:57</a></p>
      </header>
      <section>
        <p class="tweet-text">あら、テンプレートも引数が可変に。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252367938700468225"
            target="_blank">2020/4/21 7:45:59</a></p>
      </header>
      <section>
        <p class="tweet-text">ざっとC++11～C++17の内容を読んだけどすごいね。特にconstexprの拡張ぶりがね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252368422245003264"
            target="_blank">2020/4/21 7:47:54</a></p>
      </header>
      <section>
        <p class="tweet-text">関数がコンパイル時と実行時で共有できたりとか夢が広がる。しかし私が使いこなせるかというとあれだけど...。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252368744833339392"
            target="_blank">2020/4/21 7:49:11</a></p>
      </header>
      <section>
        <p class="tweet-text">constexprで思い浮かぶのはつい先日逝去された村上さんの「コンパイル時レイトレーシング」ですな。。<br/><blockquote class="card card-large"><header><img  src="http://cdn-ak.f.st-hatena.com/images/fotolife/b/boleros/20111206/20111206023017.png" /><a href="http://boleros.hateblo.jp/entry/20111205/1323106563" target="_blank">constexpr レイトレーシング - ボレロ村上 - ENiyGmaA Code</a></header><div>これは、Sprout.Darkroom ライブラリの constexpr レイトレーサーでレンダリングした画像です。 画像サイズは 512×512 pixel。 もちろん画素データはすべてコンパイル時に生成され、ファイル出力のみが実行時に行なわれています。 光源は手前右側にあり、手前の青色がかった球から奥の赤色がかった球へ落ちる影や、 反射による球形の映り込みも確認できると思います。 レイトレーシングの基本的なアルゴリズムはとてもシンプルです。 視点から各ピクセルを通る光線を飛ばして、ベクトルが オブジェクトと交差する部分の拡散光と反射光の成分を得るだけです。 さて、ではこの Sprout.D…</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252369397336772608"
            target="_blank">2020/4/21 7:51:46</a></p>
      </header>
      <section>
        <p class="tweet-text">ああ、さらにsproutというライブラリもありましたな。。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="http://bolero-murakami.github.io/Sprout/" target="_blank">Sprout C++ Libraries</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252565062201380865"
            target="_blank">2020/4/21 20:49:17</a></p>
      </header>
      <section>
        <p class="tweet-text">今はdecltypeとかconstexprとか変なテンプレートを使っておかしな実装を試みているところ。ヘンテコ実装というべきか。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252689828132470785"
            target="_blank">2020/4/22 5:05:03</a></p>
      </header>
      <section>
        <p class="tweet-text">constexpr ifとか今できるんですな。これはコンパイル時に評価される。async変数はコンパイル時には定数。asyncがtrueの時はelseの部分はバイナリにならない。 https://t.co/5BkIdBbYKK</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWJyhI_UYAAc_OQ.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252690986985127936"
            target="_blank">2020/4/22 5:09:39</a></p>
      </header>
      <section>
        <p class="tweet-text">これ使ってテンプレートメンバ関数1つで同期版・非同期版を作っている。そもそもコンパイラの最適化でelseの中身は捨てられそうな気もするけど、constexprつけといたら確実そうだし、「ここはコンパイル時に評価する」ということがソースで判別できるのがいい感じ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252711873759215617"
            target="_blank">2020/4/22 6:32:39</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしC++も気が付くと7-8年まともに触ってないから変わるのも当然か。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252851200686354433"
            target="_blank">2020/4/22 15:46:17</a></p>
      </header>
      <section>
        <p class="tweet-text">委譲コンストラクタっつうのを使ってみた。 https://t.co/9TWMBP5Veu</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWMFhbWU4AAY5-W.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252851372707287040"
            target="_blank">2020/4/22 15:46:58</a></p>
      </header>
      <section>
        <p class="tweet-text">これね。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://cpprefjp.github.io/lang/cpp11/delegating_constructors.html" target="_blank">移譲コンストラクタ - cpprefjp C++日本語リファレンス</a></header><div>「移譲コンストラクタ (delegating constructors)」は、コンストラクタから、同じクラスの他のコンストラクタに処理を移譲する機能である。</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252859034425651202"
            target="_blank">2020/4/22 16:17:25</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3のBackup系のAPIもとりあえず動くようになった。<br/>ほぼCインターフェースのまんまだが。。 https://t.co/WNZF5ettNL</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWMMkMCUMAAkozq.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252859188595716101"
            target="_blank">2020/4/22 16:18:02</a></p>
      </header>
      <section>
        <p class="tweet-text">違うのは非同期だということだけ。一応同期版も用意したが。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252861116679467011"
            target="_blank">2020/4/22 16:25:41</a></p>
      </header>
      <section>
        <p class="tweet-text">node-addon-apiはよくできてるわ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252891886554996740"
            target="_blank">2020/4/22 18:27:58</a></p>
      </header>
      <section>
        <p class="tweet-text">続いてStatementの追加実装をするか。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252930985827553280"
            target="_blank">2020/4/22 21:03:20</a></p>
      </header>
      <section>
        <p class="tweet-text">constexpr ifってすごいなあ。これは型が文字列系だったらNapi::String、数字系だったらNapi::Numberを返すとかそんんな感じなんだけど、まあこれコンパイル時に評価されるんだよなあ。あってるかどうかいまいち自信ないけど（笑）。こんなのできるようになってるとは。。 https://t.co/eJloAI19jm</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWNNTpMVcAAKMsS.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252931337150849025"
            target="_blank">2020/4/22 21:04:43</a></p>
      </header>
      <section>
        <p class="tweet-text">文字列や数値の型判定がこれでいいかというとダメだけどね。私が今回使う分の型しかないからね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1252932137323360257"
            target="_blank">2020/4/22 21:07:54</a></p>
      </header>
      <section>
        <p class="tweet-text">constexprによって、コンパイル時プログラミングがテンプレートによるものしかない時代と比べて格段にわかりやすくなってるわ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253257046696198144"
            target="_blank">2020/4/23 18:38:58</a></p>
      </header>
      <section>
        <p class="tweet-text">変数の型が数値型かどうかを判定するstd::is_arithmeticというのがあるんですな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253260207599181825"
            target="_blank">2020/4/23 18:51:32</a></p>
      </header>
      <section>
        <p class="tweet-text">でこれの文字列かどうか判定版というのがないのかな？と思って調べたがなかった。で、以下を見つけた。<br/><br/><blockquote class="card card-default"><header><img  src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded" /><a href="https://stackoverflow.com/questions/8097534/type-trait-for-strings" target="_blank">c++ - Type trait for strings - Stack Overflow</a></header><div>Is there an existing (in the standard library or in Boost) type trait to test whether a type could represent a string?<br/><br/>I stumbled upon an issue when using Boost.Fusion:<br/><br/>auto number = fusion::</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253261152848498689"
            target="_blank">2020/4/23 18:55:17</a></p>
      </header>
      <section>
        <p class="tweet-text">でこのポストに書いてあるテンプレートをconstexpr関数で書きなおせばいい感じになるのでは。。と思った。<br/><br/><blockquote class="card card-default"><header><img  src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded" /><a href="https://stackoverflow.com/a/57812868" target="_blank">c++ - Type trait for strings - Stack Overflow</a></header><div>Is there an existing (in the standard library or in Boost) type trait to test whether a type could represent a string?<br/><br/>I stumbled upon an issue when using Boost.Fusion:<br/><br/>auto number = fusion::</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253261680491937793"
            target="_blank">2020/4/23 18:57:23</a></p>
      </header>
      <section>
        <p class="tweet-text">で書き直してみたのこれ。ほぼまんまだけど。。 https://t.co/nUsUus9ee0</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWR62OuUEAUVZVr.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253262016615047173"
            target="_blank">2020/4/23 18:58:43</a></p>
      </header>
      <section>
        <p class="tweet-text">でこれとis_arithmeticを使って昨日のconstexpr ifの部分を書き換えてみた。とりあえず動きそうだ。 https://t.co/07Q5MXNwfc</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWR7HmtUcAAMLSw.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253262633366515720"
            target="_blank">2020/4/23 19:01:10</a></p>
      </header>
      <section>
        <p class="tweet-text">7－8年前の私のC++の知識からすると「ウソでしょ」というくらいのわかりやすさですよ。これ。ちゃんと動けばだけど。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253263225329602561"
            target="_blank">2020/4/23 19:03:32</a></p>
      </header>
      <section>
        <p class="tweet-text">この型に対するコンパイル時の処理が実に面白いんだよな。C++は。私の場合正しく理解して正しく面白がってるのかというとちょっと疑問だけど。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253263868802945027"
            target="_blank">2020/4/23 19:06:05</a></p>
      </header>
      <section>
        <p class="tweet-text">テンプレート・パラメータが可変長になってるので、それでできる型リストに対する操作の挑戦なんていうのもやってる人はやっぱりいる。これ2009年の記事かあ。あれ、当時はC++いじってたぞ、私（笑）。<br/><blockquote class="card card-large"><header><img  src="https://ogimage.blog.st-hatena.com/12921228815714321046/12921228815714328378/1386746567" /><a href="https://faithandbrave.hateblo.jp/entry/20090417/1239959706" target="_blank">可変引数テンプレートでの型リストまとめ - Faith and Brave - C++で遊ぼう</a></header><div>C++0xでは、可変引数テンプレートという機能が追加されます。 これを使うと、テンプレートパラメータを可変個受け取ることができ、 template &lt;class... Args&gt; // ...と書くと可変引数テンプレートになる class tuple; 可変引数テンプレートは型のリストと見なすことができます。 tuple&lt;int&gt; t1; // 要素1つ(int)の型リスト tuple&lt;int, char&gt; t2; // 要素2つ(int, char)の型リスト tuple&lt;int, char, long&gt; t3; // 要素3つ(int, char, long)の型リスト ということで、型リ…</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253264338564988930"
            target="_blank">2020/4/23 19:07:57</a></p>
      </header>
      <section>
        <p class="tweet-text">C++03だとテンプレートパラメータは可変長でないので、テンプレートの再帰でなんとか型リスト化して各種操作をライブラリ化したのがLokiなんだよな。そりゃ当時は衝撃を受けましたよ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253265765588807681"
            target="_blank">2020/4/23 19:13:37</a></p>
      </header>
      <section>
        <p class="tweet-text">node-sqlite3-napi（仮称）もそこそこ実装できてきたなあ。。あとトレース関係とか、細かいところの実装になってきた感じだな。C言語だと拡張関数とか組み込めるみたいなんだけど、うまくすればJSの拡張関数を呼んだりできるのかな？あとはJSのオブジェクトをJSON化せずまんまBrobに保存できんかな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253266267345006592"
            target="_blank">2020/4/23 19:15:37</a></p>
      </header>
      <section>
        <p class="tweet-text">まんまは無理だけど、わざわざコストをかけてJSON Stringにしないでもよいような、簡易なバイナリ・オブジェクトフォーマットに変換する感じにできないかなあ。。とか考えてる。具体的にはまるでなってないけど。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253413856568700932"
            target="_blank">2020/4/24 5:02:05</a></p>
      </header>
      <section>
        <p class="tweet-text">BSONとかMessagePackとかいうのがあるのか。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253413967780646913"
            target="_blank">2020/4/24 5:02:31</a></p>
      </header>
      <section>
        <p class="tweet-text">やっぱり思う人はいるようなあ。。<br/><blockquote class="card card-default"><header><img  src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded" /><a href="https://stackoverflow.com/questions/6218524/fastest-possible-javascript-object-serialization-with-google-v8" target="_blank">Fastest possible Javascript object serialization with Google V8 - Stack Overflow</a></header><div>I need to serialize moderately complex objects with 1-100's of mixed type properties.<br/><br/>JSON was used originally, then I switched to BSON which is marginally faster.<br/><br/>Encoding 10000 sample objects<br/><br/>...</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253414885003685888"
            target="_blank">2020/4/24 5:06:10</a></p>
      </header>
      <section>
        <p class="tweet-text">こういうのもあるな。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://nodejs.org/api/v8.html#v8_serialization_api" target="_blank">V8 | Node.js v14.8.0 Documentation</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253417740502593543"
            target="_blank">2020/4/24 5:17:31</a></p>
      </header>
      <section>
        <p class="tweet-text">あと私はメモリ管理の正確な理解と、そういう観点でおかしな実装を正さないといけない。効率的かつセキュアな実装というやつですな。move semanticsの理解を深めることがまず必要。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253444776222789632"
            target="_blank">2020/4/24 7:04:57</a></p>
      </header>
      <section>
        <p class="tweet-text">std::bindで引数束縛した関数がメモリ管理的にいいのか悪いのかという。気になってるのはローカルで定義したstd::stringのtext変数。<br/><br/>std::function&lt;int()&gt; executeFunc = std::bind(sqlite3_bind_text, stmt_, columnIndex, text.c_str(), text.size(), SQLITE_TRANSIENT); https://t.co/vuNgqVcpd5</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWUW9joUwAMLIWG.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253446359530696704"
            target="_blank">2020/4/24 7:11:14</a></p>
      </header>
      <section>
        <p class="tweet-text">std::string型のtext変数は関数で宣言されるローカル変数である。これの内部のメモリへのポインタをstd::bindで束縛するわけですな。これがまあこの関数内（正確にいうとtext変数が宣言されたスコープ内）で実行されるのであればよいし、そうでないならまずいということですわな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253447658271727616"
            target="_blank">2020/4/24 7:16:24</a></p>
      </header>
      <section>
        <p class="tweet-text">なぜならこのtextは関数を抜けると消滅してしまうから。このbindした関数オブジェクトをAsyncWorkerに渡すと関数のスコープ外で実行されてしまう。std::stringで生成され、捨てられたメモリはすぐに再利用されるわけではないので、これでも運よく（運悪く）動いてしまう。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253448909910757377"
            target="_blank">2020/4/24 7:21:22</a></p>
      </header>
      <section>
        <p class="tweet-text">でこれを保障するにはどうすればよいかというと、今回のケースではtextの内容をコピーしてbindする関数側に保持させるしかない。std::bindは束縛する引数は基本的にコピーされる。がポインタはポインタの値のみをコピーするのでこの問題は解決できない。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253449276107091970"
            target="_blank">2020/4/24 7:22:50</a></p>
      </header>
      <section>
        <p class="tweet-text">とするとstd::stringをまんまbindすればいいんだけど、apiでは引数はchar *でしか渡せないから、そのためのラッパーをかませる必要があるわけですな。意図的にコピーさせるための。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253450158135635968"
            target="_blank">2020/4/24 7:26:20</a></p>
      </header>
      <section>
        <p class="tweet-text">１つのアイデアとしてはラムダ関数を間に挟むことが考えらる。変数のキャプチャの仕組みを使って変数をコピーして、ラムダ関数内でそのコピーした変数のポインタを渡せばいいのかなと。 https://t.co/pEdgIWOqZG</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWUmHHYUwAAyIqf.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253451582340907008"
            target="_blank">2020/4/24 7:31:59</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしこの変数のコピーが気になる。これがBrobとかだとどうするんだと。とするとC++14で新しく使えるようになった「ラムダ式の初期化キャプチャ」を使ってmoveするのはどうだろうかと今思っている<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://cpprefjp.github.io/lang/cpp14/initialize_capture.html" target="_blank">ラムダ式の初期化キャプチャ - cpprefjp C++日本語リファレンス</a></header><div>「初期化キャプチャ(init-capture)」は、任意の式の結果をラムダ式にキャプチャする機能である。</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253453258091139072"
            target="_blank">2020/4/24 7:38:39</a></p>
      </header>
      <section>
        <p class="tweet-text">こんな感じですわな。 https://t.co/jZiVkqQwkq</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWUpFYRUwAEDJgW.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253453571917443072"
            target="_blank">2020/4/24 7:39:54</a></p>
      </header>
      <section>
        <p class="tweet-text">AsyncWorkerに渡した後はその変数の中身は関数内では使わないからね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253456014482870272"
            target="_blank">2020/4/24 7:49:36</a></p>
      </header>
      <section>
        <p class="tweet-text">こうして作ったstd::functionはこのFuncWorkerというAsyncWorkerを継承したクラスを作って、これに渡して実行するようにしたんですな。まあなんでこんなことしてるかというとAPIごとにAsyncWorkerを継承したクラスを作るのが面倒だからなんだけど（笑）。<br/><blockquote class="card card-large"><header><img  src="https://github.githubassets.com/images/modules/gists/gist-og-image.png" /><a href="https://gist.github.com/sfpgmr/7da1f0d6081ccd3156662a02a76662c1" target="_blank">FuncWorker.cc · GitHub</a></header><div>GitHub Gist: instantly share code, notes, and snippets.</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253622063580844032"
            target="_blank">2020/4/24 18:49:25</a></p>
      </header>
      <section>
        <p class="tweet-text">Statementもメソッドがかなり増えたな。。 https://t.co/7nWYXdbkjr</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWXCk_WU0AIroQ1.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253648042873352192"
            target="_blank">2020/4/24 20:32:39</a></p>
      </header>
      <section>
        <p class="tweet-text">v8.Serializerか。こういうのなぜv8が持ってるのかな？と思ったらpostMessageの時に使うんだな。。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://nodejs.org/api/v8.html#v8_serialization_api" target="_blank">V8 | Node.js v14.8.0 Documentation</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253648610744401920"
            target="_blank">2020/4/24 20:34:55</a></p>
      </header>
      <section>
        <p class="tweet-text">これ使うとディスクにオブジェクトをバイナリで保存できるんだよな。そう書いてあるからね。まあそりゃそうだよな。。つまりBrobにも収めることができるんだな。。しかしこれnode-addon-apiからどうやって呼ぶんだ？<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://nodejs.org/api/v8.html#v8_serialization_api" target="_blank">V8 | Node.js v14.8.0 Documentation</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253649452826603520"
            target="_blank">2020/4/24 20:38:15</a></p>
      </header>
      <section>
        <p class="tweet-text">なんかこううまくオブジェクトをバイナリ形式で保存して、それをさらにうまいこと何とかしてクエリしてデシリアライズしてもとのオブジェクトで返せないかなあと考えてるんだよね。変換コストをかけずにね。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253649655792979968"
            target="_blank">2020/4/24 20:39:04</a></p>
      </header>
      <section>
        <p class="tweet-text">しまった。Brobの綴り間違ってる。Blobだった。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253824194711662592"
            target="_blank">2020/4/25 8:12:37</a></p>
      </header>
      <section>
        <p class="tweet-text">自分でNapi::Objectのシリアライザを作ればいいんだろうけど、それはちょっと荷が重いんだよなあ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253843808908787714"
            target="_blank">2020/4/25 9:30:33</a></p>
      </header>
      <section>
        <p class="tweet-text">BlobのBindについてももうちょっと考えないといかんな。。JSのBufferとかBlobとかそのへん。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253864308607291393"
            target="_blank">2020/4/25 10:52:01</a></p>
      </header>
      <section>
        <p class="tweet-text">Napi::ValueからV8::Objectへのアクセスをなんとかしたいところだが。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253870972496568330"
            target="_blank">2020/4/25 11:18:30</a></p>
      </header>
      <section>
        <p class="tweet-text">N-APIのソースを読んでると、v8のValueのポインタをキャストしたものがnapi_valueっぽいな。なるほどそうか。。 https://t.co/l20cz1gCqT</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWakf2kU8AAECSy.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253871243045924864"
            target="_blank">2020/4/25 11:19:34</a></p>
      </header>
      <section>
        <p class="tweet-text">とするとNapi::Valueはnapi_valueをメンバに持つラッパーなので、v8のシリアライズ機能使って割と簡単にいけるかもしれんな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253872352812650497"
            target="_blank">2020/4/25 11:23:59</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしこれやってしまうとv8に依存してしまうけどね。まあとりあえずやってみよう。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1253872771332861952"
            target="_blank">2020/4/25 11:25:39</a></p>
      </header>
      <section>
        <p class="tweet-text">BlobにはBlob的なデータのバインドはもちろん、オブジェクトをシリアライズしたものもバインドできるようにしてみよう。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254016982862553090"
            target="_blank">2020/4/25 20:58:41</a></p>
      </header>
      <section>
        <p class="tweet-text">v8::ValueSerializerのテストコードがあるなあ。参考になるかな。。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://chromium.googlesource.com/chromium/src/+/7d997bde5eb18172951ccc321744929aea560d36/third_party/WebKit/Source/bindings/core/v8/serialization/V8ScriptValueSerializerTest.cpp" target="_blank">third_party/WebKit/Source/bindings/core/v8/serialization/V8ScriptValueSerializerTest.cpp - chromium/src - Git at Google</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254212596355362816"
            target="_blank">2020/4/26 9:55:59</a></p>
      </header>
      <section>
        <p class="tweet-text">ここに来てV8 APIの初歩的な知識を学ぶことにする。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/docs/embed" target="_blank">Getting started with embedding V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254212939030159360"
            target="_blank">2020/4/26 9:57:21</a></p>
      </header>
      <section>
        <p class="tweet-text">node-addon-apiを使ってv8の学習コストを避けて所望の処理を実現しようとしたが、やはりv8を避けて通ることはできないようだし、ここにきてv8にがぜん興味がわいてきてるので。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254215614769410048"
            target="_blank">2020/4/26 10:07:59</a></p>
      </header>
      <section>
        <p class="tweet-text">Isolateって何？というレベルなので（笑）。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254236891546710016"
            target="_blank">2020/4/26 11:32:32</a></p>
      </header>
      <section>
        <p class="tweet-text">v8のキーコンセプト：<br/><br/>・isolateは個々にヒープを持つVMインスタンスである<br/>・ローカルハンドルはオブジェクトへのポインタであり、v8オブジェクトはハンドル経由でアクセスする。これはガベージコレクタを動かすために必要である。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254237957763956738"
            target="_blank">2020/4/26 11:36:46</a></p>
      </header>
      <section>
        <p class="tweet-text">・ハンドルスコープはハンドルのためのコンテナ。ハンドルの利用が終わったら、個別に削除するのではなく、そのスコープで他のハンドルごと削除することができる。<br/>・コンテキストはVMインスタンス中でのJSコードを動かす単位。JSの実行にはコンテキストの指定が必要。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254238765364637697"
            target="_blank">2020/4/26 11:39:58</a></p>
      </header>
      <section>
        <p class="tweet-text">しかしこうなってくると、そもそもローカルとして作成するオブジェクトも、ガベージコレクトできるように特別なメモリ管理をしているとなれば、スコープによるライフタイム管理が通用しないというか、そういう考えだけでメモリ管理を行うとちょっと不都合が生じる気がする。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254239459341553664"
            target="_blank">2020/4/26 11:42:44</a></p>
      </header>
      <section>
        <p class="tweet-text">Isolateはn-apiではnapi_env__構造体のメンバにある。これのポインタがnapi_envという名前でtypedefされてるわけですな。 https://t.co/omvUKWlbc3</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWfz4mYU8AAyvrf.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254239860711288834"
            target="_blank">2020/4/26 11:44:20</a></p>
      </header>
      <section>
        <p class="tweet-text">v8ででてくるLocalとかPersistentとかはオブジェクトのライフタイムを既定する、いいかえればガベージコレクタに確保したメモリリソースの有効期間をおしえるものなのかなあ。。と今思ってるところ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254239965745053696"
            target="_blank">2020/4/26 11:44:45</a></p>
      </header>
      <section>
        <p class="tweet-text">実体はスマポっぽい実装だけどね。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254240087635705856"
            target="_blank">2020/4/26 11:45:14</a></p>
      </header>
      <section>
        <p class="tweet-text">この辺をきちんと読むことにしよう。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/docs/embed#handles-and-garbage-collection" target="_blank">Getting started with embedding V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254291372577681410"
            target="_blank">2020/4/26 15:09:01</a></p>
      </header>
      <section>
        <p class="tweet-text">Local ... 局所的。ハンドルはスタックに作成される。HandleScopeでライフタイムを管理。<br/>Persisitant ... 永続的。ハンドルはヒープに作成される。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254292337619918849"
            target="_blank">2020/4/26 15:12:51</a></p>
      </header>
      <section>
        <p class="tweet-text">Eternalというのもあるんですな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254292849316605952"
            target="_blank">2020/4/26 15:14:53</a></p>
      </header>
      <section>
        <p class="tweet-text"><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/_img/docs/embed/local-persist-handles-review.png" target="_blank">local-persist-handles-review.png (748×292)</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254294679090126850"
            target="_blank">2020/4/26 15:22:09</a></p>
      </header>
      <section>
        <p class="tweet-text">オブジェクト自体はLocalもPersistantもヒープ上に作られるのか。そしてその参照となるハンドルがスタックに作られるかヒープに作られるかの違いがあるんだな。ローカルの方は関数を抜けるとハンドルがすべて削除されてオブジェクトへのハンドルがなくなるので、ガベコレに回収されると。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254299267381903360"
            target="_blank">2020/4/26 15:40:23</a></p>
      </header>
      <section>
        <p class="tweet-text">PersistantハンドルはResetで明示的に開放しないとずっと保持されるわけですな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254300751418896385"
            target="_blank">2020/4/26 15:46:17</a></p>
      </header>
      <section>
        <p class="tweet-text">ああ、そういうことか。。v8のオブジェクト作るときはv8::(Obj)::Newというファクトリメソッドを使うんだけど、ここでオブジェクトをヒープに作りつつ、その参照をハンドル・スタックに作って返すということをやるんですな。HandleScopeというのはそのハンドル・スタックそのものなんだね。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254301890147282944"
            target="_blank">2020/4/26 15:50:49</a></p>
      </header>
      <section>
        <p class="tweet-text">そのために関数の冒頭でHandleStackをisolate*を引数にして作っとくんだな。その関数で作るLocalハンドルはすべてHandleScopeのハンドル・スタックで保持され、関数を抜けるときにHandleStackが消えると、こういうわけなんですな。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254302533956202496"
            target="_blank">2020/4/26 15:53:22</a></p>
      </header>
      <section>
        <p class="tweet-text">ということはLocalハンドル自体は戻り値として返すことはできない。関数を抜けるときに削除されてしまうからね。その場合はHandleScope::Escapeして返すと。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254307237905891328"
            target="_blank">2020/4/26 16:12:04</a></p>
      </header>
      <section>
        <p class="tweet-text">ここ読んでコンテキストの必要性を認識した。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/docs/embed#contexts" target="_blank">Getting started with embedding V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254528109736386560"
            target="_blank">2020/4/27 6:49:44</a></p>
      </header>
      <section>
        <p class="tweet-text">v8を少し理解できたと同時に、私の実装がnode-addon-apiのお作法に著しく反していることに気づき実装をやり直しているところ。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254533714672906240"
            target="_blank">2020/4/27 7:12:00</a></p>
      </header>
      <section>
        <p class="tweet-text">v8(JS)オブジェクト自体は基本ヒープに作られて、そこへはポインタ（ハンドル）経由でアクセスする。そのポインタはスタックで作られるか、ヒープで作られる。これが念頭にないので、C++で作るオブジェクトのメモリ管理とごっちゃになってしまってた。。非常によろしくない。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254534011881316353"
            target="_blank">2020/4/27 7:13:11</a></p>
      </header>
      <section>
        <p class="tweet-text">今までの実装はたまたま動いてたということ。。ひぃぃ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254888116889911296"
            target="_blank">2020/4/28 6:40:16</a></p>
      </header>
      <section>
        <p class="tweet-text">この辺も今一度読み直さないといけない。<br/><br/><blockquote class="card card-default"><header><img  src="https://avatars1.githubusercontent.com/u/9950313?s=400&v=4" /><a href="https://github.com/nodejs/node-addon-api/blob/master/doc/object_lifetime_management.md" target="_blank">node-addon-api/object_lifetime_management.md at master · nodejs/node-addon-api · GitHub</a></header><div>Module for using N-API from C++. Contribute to nodejs/node-addon-api development by creating an account on GitHub.</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254888531278757888"
            target="_blank">2020/4/28 6:41:55</a></p>
      </header>
      <section>
        <p class="tweet-text">sqlite3_execのラッパーメソッドはAsyncProgressWorkerで書き直そうと思ってるところ。<br/><br/><blockquote class="card card-default"><header><img  src="https://avatars1.githubusercontent.com/u/9950313?s=400&v=4" /><a href="https://github.com/nodejs/node-addon-api/blob/master/doc/async_worker_variants.md" target="_blank">node-addon-api/async_worker_variants.md at master · nodejs/node-addon-api · GitHub</a></header><div>Module for using N-API from C++. Contribute to nodejs/node-addon-api development by creating an account on GitHub.</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255076204979224576"
            target="_blank">2020/4/28 19:07:40</a></p>
      </header>
      <section>
        <p class="tweet-text">実装を端折るために禁断のvoid *を使ってしまった。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255076305751531522"
            target="_blank">2020/4/28 19:08:04</a></p>
      </header>
      <section>
        <p class="tweet-text">これとreinterpret_castを使った。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255076450085900288"
            target="_blank">2020/4/28 19:08:38</a></p>
      </header>
      <section>
        <p class="tweet-text">ちょっと前のコードはv8のメモリ・マネジメントを知らずに適当に書いた赤っ恥コードのような気が。今ちゃんと書けてるのかというとそうでもないが（笑）。もうちょっと勉強が必要。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255076742143721475"
            target="_blank">2020/4/28 19:09:48</a></p>
      </header>
      <section>
        <p class="tweet-text">いやーでも面白いわ。。そもそもsqlite3のラッパーをなんで書いてるのか半分忘れてる始末（笑）</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255077609022435335"
            target="_blank">2020/4/28 19:13:14</a></p>
      </header>
      <section>
        <p class="tweet-text">AsyncProgressWorkerはドキュメントではテンプレートクラスではないがコードを読むとテンプレートクラスになっとるな。。コンパイルエラーになるからなんで？と思って調べた結果。 https://t.co/ZdHNMLWxp1</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWruWroU0AIjOmR.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255078328924377088"
            target="_blank">2020/4/28 19:16:06</a></p>
      </header>
      <section>
        <p class="tweet-text">どうもSendするときのデータがvoid *じゃなくてT*になったようだな。void * はCとやり取りする以外はあまり使わんほうがいいもんね。といいつつ便利さに負けてさっき使ってしまったけど（笑） https://t.co/6Cd74XPoEo</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWrulgaUEAA8PUz.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255078643212013568"
            target="_blank">2020/4/28 19:17:21</a></p>
      </header>
      <section>
        <p class="tweet-text">v8 のドキュメントをちょこちょこ読んでくか。私にはDeepLという強い味方が（笑）<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255267928066461697"
            target="_blank">2020/4/29 7:49:30</a></p>
      </header>
      <section>
        <p class="tweet-text">いわゆるv8のハンドルはタグ付き値なんですな。<br/>最下位ビットをSMIかポインタのフラグに使っていて、ポインタはさらにweak/strongの識別に１ビット使ってると。アドレスは4バイトでアラインメントされるから、2ビットをフラグに使って4GBのアドレス空間を指定できるわけですな。 https://t.co/plPD5L2Uqm</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWua2syXgAMzUdv.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255269123162079233"
            target="_blank">2020/4/29 7:54:15</a></p>
      </header>
      <section>
        <p class="tweet-text">通常のJSであれば32bitの整数値はdoubleに変換され、<br/>さらにv8のセオリーに従えばそれはヒープに8バイトでアサインされ、ポインタとなるタグ付き値4バイト、計12バイト必要になるところを、31ビット内に収まる整数値の場合はタグ付き値の4バイト内に最下位ビットを0にして収める。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255269636452552704"
            target="_blank">2020/4/29 7:56:17</a></p>
      </header>
      <section>
        <p class="tweet-text">64ビットアーキテクチャになるとタグ付き値は以下のようなフォーマットになってる。32ビットのそれをそのまま拡張したような使用ですわな。 https://t.co/hISiNpPUDd</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWudAeJXkAI0COP.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255279016589787137"
            target="_blank">2020/4/29 8:33:34</a></p>
      </header>
      <section>
        <p class="tweet-text">64ビットのタグ付き値を32ビットに圧縮するためにポインタはベースとオフセットに分ける。ベースアドレスはv8インスタンスごとに持つらしい。実際のヒープのアドレスを求めるにはベースアドレスを足すわけですな。 https://t.co/9nb26G8kXw</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWulF7BWkAAe6AT.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255279477556482050"
            target="_blank">2020/4/29 8:35:24</a></p>
      </header>
      <section>
        <p class="tweet-text">SMIは上位をサインビットで埋める。こうしてSMIとオブジェクトのポインタ値を32ビット内に収める。 https://t.co/EZjsafGi2X</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWulvIvWAAAOPag.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255279694209069057"
            target="_blank">2020/4/29 8:36:15</a></p>
      </header>
      <section>
        <p class="tweet-text">こうなるのですな。。 https://t.co/zQsyRcQ680</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWumObiXQAAz_d_.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255280236029231104"
            target="_blank">2020/4/29 8:38:24</a></p>
      </header>
      <section>
        <p class="tweet-text">でさらにヒープのレイアウトを工夫して、圧縮されたタグ付き値の展開計算を簡単にしてるということだそうだ。 https://t.co/jmBgG91JDA</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWumjOBXQAERdNH.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255280798040809472"
            target="_blank">2020/4/29 8:40:38</a></p>
      </header>
      <section>
        <p class="tweet-text">こうすることで分岐なしでSMIとポインタを正しく復元できるとのこと。すごいね。。 https://t.co/Ng0Q2H8ux9</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWunG8QWsAIgVIb.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255281396421201921"
            target="_blank">2020/4/29 8:43:01</a></p>
      </header>
      <section>
        <p class="tweet-text">圧縮されたタグ付き値と通常の64ビットポインタとのパフォーマンス比較。当初35%の開きがあったが、5%までに差は縮小できたとのこと。 https://t.co/Nj13xVva1I</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWunxG0XkAIMwYN.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255283471163015168"
            target="_blank">2020/4/29 8:51:16</a></p>
      </header>
      <section>
        <p class="tweet-text">さっきのタグ付き値の復元コードは分岐なしのほうが速い予測だったが、x64では分岐バージョンのほうが7%速かったとのこと。右側のほうが速い。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#bump-(1)%2C-%2B7%25" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote> https://t.co/X0pDVH1Yqh</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWupBSKXkAYLzzW.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255284498520047617"
            target="_blank">2020/4/29 8:55:21</a></p>
      </header>
      <section>
        <p class="tweet-text">Armはハイエンドだとやはり分岐バージョンがはやくて、ローエンドだとあまり差がなかったそうだ。現代のCPUの分岐予測はとても優秀で、分岐の有無よりもコードサイズがパフォーマンスに影響を与えるとのこと。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255286099800457220"
            target="_blank">2020/4/29 9:01:42</a></p>
      </header>
      <section>
        <p class="tweet-text">あとはTurbofun周りの最適化によって5%までに差を縮めたとのこと。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255288120473509888"
            target="_blank">2020/4/29 9:09:44</a></p>
      </header>
      <section>
        <p class="tweet-text">Turbofun周りの話はいまいち理解できない状況。。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#bump-(2)%2C-%2B2%25" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255289168273575936"
            target="_blank">2020/4/29 9:13:54</a></p>
      </header>
      <section>
        <p class="tweet-text">いろいろ最適化を行った結果、次のステップでは2%までに差が縮まったとのこと。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#further-improvements" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote> https://t.co/tqc5i0q0Ve</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWuu19EWAAAnMEU.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255289526584557568"
            target="_blank">2020/4/29 9:15:19</a></p>
      </header>
      <section>
        <p class="tweet-text">主なアプローチとしては“Smi-corrupting”。簡単にいうと64ビット展開時のSMIの上位32ビットを無視というか未定義とすることで展開のコードを短縮する。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#bump-(6)%2C-%2B2.5%25" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255289759276154882"
            target="_blank">2020/4/29 9:16:15</a></p>
      </header>
      <section>
        <p class="tweet-text">当初のコードがこれで・・ https://t.co/BsHf7M54qK</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWuvVLzXYAIf8dA.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255289925093769219"
            target="_blank">2020/4/29 9:16:54</a></p>
      </header>
      <section>
        <p class="tweet-text">そして“Smi-corrupting”によって改良されたコードがこれ。 https://t.co/syzv33dDxL</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWuva-gXgAI9ok-.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255290383870894081"
            target="_blank">2020/4/29 9:18:44</a></p>
      </header>
      <section>
        <p class="tweet-text">コンパイラが吐くアセンブラコードの比較。分岐がなくなりかつさらにコードが短縮されたのでパフォーマンスが2.5%改善したとのこと。 https://t.co/oTS1JiZbAE</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWuvx7AX0AAlcB1.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255291735481163779"
            target="_blank">2020/4/29 9:24:06</a></p>
      </header>
      <section>
        <p class="tweet-text">最終的には圧縮版のほうが素のポインタ版よりもパフォーマンスが上回ってるな。。どういうことだ？<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#remaining-gap" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote> https://t.co/dKBYp4VakI</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWuxI0rWAAAb32z.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255292897454325763"
            target="_blank">2020/4/29 9:28:43</a></p>
      </header>
      <section>
        <p class="tweet-text">Remainig Gapに書かれてあることはちょっとよくわからない。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#remaining-gap" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255294460298174465"
            target="_blank">2020/4/29 9:34:56</a></p>
      </header>
      <section>
        <p class="tweet-text">結局ポインタの圧縮によってヒープのメモリサイズが4割程度削減できたとのこと。<br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#results" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255296176699650048"
            target="_blank">2020/4/29 9:41:45</a></p>
      </header>
      <section>
        <p class="tweet-text">今後は<br/><br/>・生成されたアセンブリコードの品質を向上させる<br/>・8GB～16GBのより大きなヒープをサポート<br/><br/>に取り組むと書いてあるね。。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#conclusion" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255296872060682242"
            target="_blank">2020/4/29 9:44:31</a></p>
      </header>
      <section>
        <p class="tweet-text">Double Field Unboxingの部分はちょっと休憩というか洗車してから再び理解にチャレンジしよう。。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#double-field-unboxing-(8)%2C--3%25" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255297574325686273"
            target="_blank">2020/4/29 9:47:18</a></p>
      </header>
      <section>
        <p class="tweet-text">いやそれはそれとして、sqlite3のラッパー実装のやり直しも進めんとなあ。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255297731091890177"
            target="_blank">2020/4/29 9:47:56</a></p>
      </header>
      <section>
        <p class="tweet-text">でもここもちょっと理解できてないけど気になるところなんだよなあ。<br/><br/>TurboFan is V8’s optimizing compiler, built around a concept called “Sea of Nodes”. <br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/pointer-compression#bump-(2)%2C-%2B2%25" target="_blank">Pointer Compression in V8 · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255779029971435521"
            target="_blank">2020/4/30 17:40:26</a></p>
      </header>
      <section>
        <p class="tweet-text">テンプレート周りをいじってると出るこの手の長いエラー。C++やってると実感する。おそらく凡ミスだが。 https://t.co/gqCDxMDyO4</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EW1sQSdU0AE_Tn_.png" />
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255780962161487872"
            target="_blank">2020/4/30 17:48:07</a></p>
      </header>
      <section>
        <p class="tweet-text">そういうわけでやはり凡ミス。。</p>
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1212701145379946496/pSDVrvWj_normal.png" />
        <p class="tweet-user-name">S.F.@SFPGMR</p>
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255416250039222274"
            target="_blank">2020/4/29 17:38:53</a></p>
      </header>
      <section>
        <p class="tweet-text">REAPERも6にアップデートしたので記念にアップしてみた。<br/><div class="youtube" data-type="yt" id="AlCLDkGfJJ4"><div class="yt-title">Youtube - YMO - RYDEEN (95)</div><svg class="player-play" width="64" height="64" xmlns="http://www.w3.org/2000/svg"><g><path class="player-play-1" fill="#ffffff" stroke-width="1" d="m0,0l64,32l-64,32l0,-64z" /></g></svg><img  data-href="https://youtu.be/AlCLDkGfJJ4" class="youtube" src="https://i.ytimg.com/vi/AlCLDkGfJJ4/hqdefault.jpg" /></div>   <br/></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255416798461276161"
            target="_blank">2020/4/29 17:41:03</a></p>
      </header>
      <section>
        <p class="tweet-text">REAPERも6になってUIとかもフラットになったりとか、機能もアップデートしてそうなのだが全然触ってないんだよね。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255417150635900933"
            target="_blank">2020/4/29 17:42:27</a></p>
      </header>
      <section>
        <p class="tweet-text">CPUやGPUもアップデートしたせいか、REAPERで再生しつつキャプチャしてもぜんぜん音切れしたりしなくなったな。技術の進化を実感。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255417870181380097"
            target="_blank">2020/4/29 17:45:19</a></p>
      </header>
      <section>
        <p class="tweet-text">前の(94)とからは相当いじってるつもりなのだ聴き比べるとあんまりかわらんな（笑）。<br/><br/><div class="youtube" data-type="yt" id="4TphvABArpI"><div class="yt-title">Youtube - YMO - RYDEEN (94)</div><svg class="player-play" width="64" height="64" xmlns="http://www.w3.org/2000/svg"><g><path class="player-play-1" fill="#ffffff" stroke-width="1" d="m0,0l64,32l-64,32l0,-64z" /></g></svg><img  data-href="https://youtu.be/4TphvABArpI" class="youtube" src="https://i.ytimg.com/vi/4TphvABArpI/hqdefault.jpg" /></div>   <br/></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255429532032684032"
            target="_blank">2020/4/29 18:31:39</a></p>
      </header>
      <section>
        <p class="tweet-text">Psycleでやってた頃のやつと比べるとかなり違うよな。。この時のやつはいっぱい間違ってるとこあるわ。今のバージョンも正解かいうとわからんが。。<br/><br/><div class="youtube" data-type="yt" id="ezjRM_a_Ha4"><div class="yt-title">Youtube - YMO - Rydeen 高画質版</div><svg class="player-play" width="64" height="64" xmlns="http://www.w3.org/2000/svg"><g><path class="player-play-1" fill="#ffffff" stroke-width="1" d="m0,0l64,32l-64,32l0,-64z" /></g></svg><img  data-href="https://youtu.be/ezjRM_a_Ha4" class="youtube" src="https://i.ytimg.com/vi/ezjRM_a_Ha4/hqdefault.jpg" /></div>   <br/></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255429808915451904"
            target="_blank">2020/4/29 18:32:45</a></p>
      </header>
      <section>
        <p class="tweet-text">X1cというPSG搭載パソコンとダブルラジカセでピンポン録音で作りはじてから35年経過してるという。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255430457644273664"
            target="_blank">2020/4/29 18:35:20</a></p>
      </header>
      <section>
        <p class="tweet-text">オリジナル聴くとやっぱり音も太いし、ミックスもいい塩梅で、すばらしいというほかない。この境地には到底達しえないわな。。<br/><div class="youtube" data-type="yt" id="wK9zzpiaL88"><div class="yt-title">Youtube - Rydeen - YMO</div><svg class="player-play" width="64" height="64" xmlns="http://www.w3.org/2000/svg"><g><path class="player-play-1" fill="#ffffff" stroke-width="1" d="m0,0l64,32l-64,32l0,-64z" /></g></svg><img  data-href="https://youtu.be/wK9zzpiaL88" class="youtube" src="https://i.ytimg.com/vi/wK9zzpiaL88/hqdefault.jpg" /></div>   <br/></p>
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1709281035/P1030575_normal.JPG" />
        <p class="tweet-user-name">shinyaman@shinyaman2</p>
        
        <p class="tweet-date"><a href="https://twitter.com/shinyaman2/status/1254986166908026880"
            target="_blank">2020/4/28 13:09:53</a></p>
      </header>
      <section>
        <p class="tweet-text">1980年の今日、任天堂のゲーム＆ウォッチが発売になったようです。<br/>このCMが録画されたビデオテープも40周年なわけですよ。<br/>ノイズはあるけどいまだにカビてなくて再生出来るのも凄い。<br/><br/>@retoro_mode https://t.co/HhuW2bdZVn</p>
        
        <video class="tweet-img" controls src="https://video.twimg.com/ext_tw_video/1254985312096276481/pu/vid/480x360/ul26j-V7fJmRUXoM.mp4?tag=10" />
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1212701145379946496/pSDVrvWj_normal.png" />
        <p class="tweet-user-name">S.F.@SFPGMR</p>
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255095666734321664"
            target="_blank">2020/4/28 20:25:00</a></p>
      </header>
      <section>
        <p class="tweet-text">肺炎にかかるとつらい。それは40代で経験したのでわかる。私の場合細菌性肺炎で、ジスロマックという抗生物質がものすごく効いたから大事にならなくて済んだけど。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255096495826558977"
            target="_blank">2020/4/28 20:28:17</a></p>
      </header>
      <section>
        <p class="tweet-text">風邪と違う点は、熱が午前中は少し下がるのに夕方になるとまた上がるのが数日以上続いてすごく消耗するし、何より息切れがひどくて階段のぼると窒息しそうなほどだった。これはただの風邪ではないな。。とその時思ったね。そしてレントゲン撮ると真っ白だったという。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255097771352141824"
            target="_blank">2020/4/28 20:33:21</a></p>
      </header>
      <section>
        <p class="tweet-text">そのとき抗生物質が効かなかったらどうなってただろうと今になってちょっと思う。今のコロナには食い止めるワクチンやインフルエンザのような抗ウィルス薬がないわけだからね。今の私に肺炎にかかって自然治癒まで体力が持つ自信があるかというとちょっとないな。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255099386096308224"
            target="_blank">2020/4/28 20:39:46</a></p>
      </header>
      <section>
        <p class="tweet-text">それくらいきつかったんだよね。。</p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255101639238676480"
            target="_blank">2020/4/28 20:48:44</a></p>
      </header>
      <section>
        <p class="tweet-text">コロナが起こす肺炎はいわゆる間質性肺炎というやつなんだな。。後遺症残るかもしれないやつだよな。恐ろしいわ。。<br/><br/><blockquote class="card card-default"><header><img  src="https://www.katoiin.info/asset/IP1.JPG" /><a href="https://www.katoiin.info/blog/2020/03/post-85-727079.html" target="_blank">新型コロナウイルスによる肺炎とは？他の肺炎と何が違うの？ | 医師ブログ</a></header><div>新型コロナウイルスについての話題でほぼ占められている昨今、メディアには様々な情報が伝えられています。特に最近は、世間がよく知っている有名人の方が罹患したというニュースが次々と取り上げられるようになっており、その症状について皆さんの関心が寄せ...</div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255107488271097857"
            target="_blank">2020/4/28 21:11:58</a></p>
      </header>
      <section>
        <p class="tweet-text">私ができることは<br/><br/>１．このウィルスは不顕性の人も多いので、無自覚にうつしてしまうリスクを下げるために常にマスクをする。<br/>２．石鹸で手洗いをして除ウィルスに努め、口腔内・鼻腔内に入るウィルスの数を減らす。<br/>３．できる限り人と接触しない<br/><br/>だよなあ。</p>
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1273893604637896705/dGaMqg94_normal.png" />
        <p class="tweet-user-name">ライブドアニュース@livedoornews</p>
        
        <p class="tweet-date"><a href="https://twitter.com/livedoornews/status/1254940480762085376"
            target="_blank">2020/4/28 10:08:20</a></p>
      </header>
      <section>
        <p class="tweet-text">【嬉しい】北海道の人気土産「じゃがポックル」オンライン販売を開始<br/><a href="https://news.livedoor.com/article/detail/18181606/" target="_blank">news.livedoor.com/article/detail…</a><br/><br/>北海道に来るのが難しい人たちにも楽しんでもらおうと販売を開始。公式ショップ「グラノライフ」内で購入できます。 https://t.co/Yhzekf6equ</p>
        
        <img  class="tweet-img" src="https://pbs.twimg.com/media/EWpxjZ3U4AAaYxl.jpg" />
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1232909058786484224/X8-z940J_normal.png" />
        <p class="tweet-user-name">NHKニュース@nhk_news</p>
        
        <p class="tweet-date"><a href="https://twitter.com/nhk_news/status/1254914377452584960"
            target="_blank">2020/4/28 8:24:37</a></p>
      </header>
      <section>
        <p class="tweet-text">アメリカ国防総省は、高速で上空を移動するＵＦＯ＝未確認飛行物体だとする映像を公開しました。写っている物体が何なのかはわかっていないとしています。<br/><a href="https://www3.nhk.or.jp/news/html/20200428/k10012408331000.html" target="_blank">www3.nhk.or.jp/news/html/2020…</a><br/>#nhk_news https://t.co/RtPPvFwTQK</p>
        
        <video class="tweet-img" controls src="https://video.twimg.com/ext_tw_video/1254914333060009986/pu/vid/640x360/pq2kJW5J8ARUBBtR.mp4?tag=10" />
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1212701145379946496/pSDVrvWj_normal.png" />
        <p class="tweet-user-name">S.F.@SFPGMR</p>
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255073188557414400"
            target="_blank">2020/4/28 18:55:40</a></p>
      </header>
      <section>
        <p class="tweet-text">このデコンパイラのシンタックスっていい感じだなあ。これをコンパイルできるようにするつもりはないらしいけど。<br/><br/><blockquote class="card card-default"><header><div class="no-image" >No Image</div><a href="https://v8.dev/blog/wasm-decompile" target="_blank">What’s in that .wasm? Introducing: wasm-decompile · V8</a></header><div></div></blockquote></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1255073800426684416"
            target="_blank">2020/4/28 18:58:06</a></p>
      </header>
      <section>
        <p class="tweet-text">ただ私自身はS式に結構慣れてきてて、このシンプルな式表現に愛着を感じてさえいる。。</p>
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/881818234621743104/_Iegct3S_normal.png" />
        <p class="tweet-user-name">V8@v8js</p>
        
        <p class="tweet-date"><a href="https://twitter.com/v8js/status/1254829913561014272"
            target="_blank">2020/4/28 2:48:59</a></p>
      </header>
      <section>
        <p class="tweet-text">What’s in that .wasm? 🔍 <br/><br/>Introducing: wasm-decompile! <a href="https://v8.dev/blog/wasm-decompile" target="_blank">v8.dev/blog/wasm-deco…</a><br/><br/>Read the contents of WebAssembly modules in a more friendly and familiar way.</p>
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1212701145379946496/pSDVrvWj_normal.png" />
        <p class="tweet-user-name">S.F.@SFPGMR</p>
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254747653499318273"
            target="_blank">2020/4/27 21:22:07</a></p>
      </header>
      <section>
        <p class="tweet-text">Tales from the Loop を一気に観た。面白かった。</p>
        
      </section>
      
    </article>
    
    <article>
      
      
      <header class="tweet-header">
        
        <img class="tweet-profile-img"  src="https://pbs.twimg.com/profile_images/1212701145379946496/pSDVrvWj_normal.png" />
        <p class="tweet-user-name">S.F.@SFPGMR</p>
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254535999503257600"
            target="_blank">2020/4/27 7:21:05</a></p>
      </header>
      <section>
        <p class="tweet-text">クレイジークライマーはBGMやサウンドエフェクトも革新的だったと思うんだよな。何せオープニングのBGMのドラムがサンプリングだもんね。それにSEもサンプリングだし。<br/><br/><div class="youtube" data-type="yt" id="7lMKC1FZBTs"><div class="yt-title">Youtube - 1980 [60fps] Crazy Climber 611600pts</div><svg class="player-play" width="64" height="64" xmlns="http://www.w3.org/2000/svg"><g><path class="player-play-1" fill="#ffffff" stroke-width="1" d="m0,0l64,32l-64,32l0,-64z" /></g></svg><img  data-href="https://youtu.be/7lMKC1FZBTs" class="youtube" src="https://i.ytimg.com/vi/7lMKC1FZBTs/hqdefault.jpg" /></div>   <br/></p>
        
      </section>
      
      <header class="tweet-header">
        
        <p class="tweet-date"><a href="https://twitter.com/SFPGMR/status/1254536586068242432"
            target="_blank">2020/4/27 7:23:24</a></p>
      </header>
      <section>
        <p class="tweet-text">ニューヨーク・ニューヨークも「Wow」と「Yeah!」かサンプリング・ボイスでしたな。当時は驚きましたが。<br/><br/><div class="youtube" data-type="yt" id="6rGnnOfTGjY"><div class="yt-title">Youtube - [AC] ニューヨーク・ニューヨーク New York! New York!</div><svg class="player-play" width="64" height="64" xmlns="http://www.w3.org/2000/svg"><g><path class="player-play-1" fill="#ffffff" stroke-width="1" d="m0,0l64,32l-64,32l0,-64z" /></g></svg><img  data-href="https://youtu.be/6rGnnOfTGjY" class="youtube" src="https://i.ytimg.com/vi/6rGnnOfTGjY/hqdefault.jpg" /></div>   <br/></p>
        
      </section>
      
    </article>
    
  </div>
  <footer>
    CopyLight 2019 Satoshi Fujiwara
  </footer>
  <script async src="https://platform.twitter.com/widgets.js"></script>

  <script async src="./index.js"></script>

</body>

</html>